# ğŸ“¹ WebSocketæ‘„åƒå¤´æœåŠ¡

åŸºäºWebSocketçš„å®æ—¶æ‘„åƒå¤´å›¾åƒä¼ è¾“æœåŠ¡ï¼Œæ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶è¿æ¥ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **å®æ—¶ä¼ è¾“**: é€šè¿‡WebSocketå®æ—¶ä¼ è¾“æ‘„åƒå¤´å›¾åƒ
- **å¤šå®¢æˆ·ç«¯**: æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥
- **ä½å»¶è¿Ÿ**: ä¼˜åŒ–çš„å›¾åƒç¼–ç å’Œä¼ è¾“
- **è·¨å¹³å°**: æ”¯æŒå„ç§ç¼–ç¨‹è¯­è¨€çš„WebSocketå®¢æˆ·ç«¯
- **å±€åŸŸç½‘è®¿é—®**: æ”¯æŒå±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡è®¿é—®

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.7+
- æ‘„åƒå¤´è®¾å¤‡ï¼ˆå†…ç½®æˆ–å¤–æ¥ï¼‰
- macOS/Linux/Windows

## ğŸ› ï¸ å®‰è£…æ­¥éª¤

1. **å®‰è£…ä¾èµ–åŒ…**
   ```bash
   pip install -r requirements.txt
   ```

2. **è¿è¡ŒWebSocketæœåŠ¡å™¨**
   ```bash
   python websocket_camera.py
   ```

## ğŸŒ è®¿é—®åœ°å€

å¯åŠ¨æœåŠ¡å™¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è¿æ¥ï¼š

### æœ¬åœ°è®¿é—®
- `ws://localhost:8765`
- `ws://127.0.0.1:8765`

### å±€åŸŸç½‘è®¿é—®
- `ws://[æœ¬æœºIP]:8765`

ä¾‹å¦‚ï¼š`ws://192.168.1.100:8765`

## ğŸ“¡ æ•°æ®æ ¼å¼

æœåŠ¡å™¨å‘é€çš„JSONæ¶ˆæ¯æ ¼å¼ï¼š

```json
{
    "type": "image",
    "data": "base64ç¼–ç çš„JPEGå›¾åƒ",
    "timestamp": 1234567890.123
}
```

é”™è¯¯æ¶ˆæ¯æ ¼å¼ï¼š
```json
{
    "type": "error",
    "message": "é”™è¯¯æè¿°"
}
```

## ğŸ§ª æµ‹è¯•å®¢æˆ·ç«¯

### 1. Pythonå®¢æˆ·ç«¯
```bash
# æœ¬åœ°æµ‹è¯•
python websocket_client.py

# å±€åŸŸç½‘æµ‹è¯•
python websocket_client.py ws://192.168.1.100:8765
```

### 2. Webæµè§ˆå™¨å®¢æˆ·ç«¯
1. æ‰“å¼€ `websocket_client.html` æ–‡ä»¶
2. è¾“å…¥WebSocketæœåŠ¡å™¨åœ°å€
3. ç‚¹å‡»"è¿æ¥"æŒ‰é’®

### 3. è‡ªå®šä¹‰å®¢æˆ·ç«¯
å¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒWebSocketçš„ç¼–ç¨‹è¯­è¨€ï¼š

**JavaScriptç¤ºä¾‹ï¼š**
```javascript
const ws = new WebSocket('ws://localhost:8765');
ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    if (data.type === 'image') {
        const img = document.createElement('img');
        img.src = 'data:image/jpeg;base64,' + data.data;
        document.body.appendChild(img);
    }
};
```

**Pythonç¤ºä¾‹ï¼š**
```python
import asyncio
import websockets
import json

async def client():
    async with websockets.connect('ws://localhost:8765') as websocket:
        async for message in websocket:
            data = json.loads(message)
            if data['type'] == 'image':
                print(f"æ”¶åˆ°å›¾åƒï¼Œæ—¶é—´æˆ³: {data['timestamp']}")

asyncio.run(client())
```

## ğŸ”§ é…ç½®é€‰é¡¹

### æ‘„åƒå¤´ç´¢å¼•
é»˜è®¤ä½¿ç”¨æ‘„åƒå¤´ç´¢å¼•0ã€‚å¦‚éœ€ä½¿ç”¨å…¶ä»–æ‘„åƒå¤´ï¼š

```python
camera_stream = CameraStream(camera_index=1)  # ä½¿ç”¨ç¬¬äºŒä¸ªæ‘„åƒå¤´
```

### ç«¯å£é…ç½®
é»˜è®¤ç«¯å£ä¸º8765ï¼Œå¯ä¿®æ”¹ï¼š

```python
server = await websockets.serve(camera_handler, "0.0.0.0", 8765)
```

### å›¾åƒè´¨é‡
å¯è°ƒæ•´JPEGå‹ç¼©è´¨é‡ï¼š

```python
img_base64 = frame_to_base64(frame, quality=90)  # 0-100
```

### ä¼ è¾“é¢‘ç‡
å¯è°ƒæ•´å›¾åƒä¼ è¾“é¢‘ç‡ï¼š

```python
await asyncio.sleep(0.1)  # 10 FPS
```

## ğŸ“± ä½¿ç”¨åœºæ™¯

1. **å®æ—¶ç›‘æ§**: å¤šå®¢æˆ·ç«¯åŒæ—¶æŸ¥çœ‹æ‘„åƒå¤´ç”»é¢
2. **è¿œç¨‹æ§åˆ¶**: é€šè¿‡WebSocketæ§åˆ¶æ‘„åƒå¤´
3. **å›¾åƒå¤„ç†**: å®¢æˆ·ç«¯æ¥æ”¶å›¾åƒè¿›è¡ŒAIåˆ†æ
4. **ç§»åŠ¨åº”ç”¨**: æ‰‹æœºAPPå®æ—¶æŸ¥çœ‹æ‘„åƒå¤´
5. **Webåº”ç”¨**: ç½‘é¡µä¸­åµŒå…¥å®æ—¶æ‘„åƒå¤´

## ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

- ç¨‹åºç»‘å®šåˆ° `0.0.0.0`ï¼Œæ”¯æŒå±€åŸŸç½‘è®¿é—®
- ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®é…ç½®é˜²ç«å¢™è§„åˆ™
- ä¸è¦å°†ç¨‹åºæš´éœ²åˆ°å…¬ç½‘ç¯å¢ƒ
- è€ƒè™‘æ·»åŠ èº«ä»½éªŒè¯æœºåˆ¶

## ğŸ” æ•…éšœæ’é™¤

### è¿æ¥å¤±è´¥
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ
- ç¡®è®¤ç«¯å£8765æœªè¢«å ç”¨
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### å›¾åƒå»¶è¿Ÿé«˜
- é™ä½å›¾åƒè´¨é‡ï¼ˆqualityå‚æ•°ï¼‰
- å‡å°‘ä¼ è¾“é¢‘ç‡
- æ£€æŸ¥ç½‘ç»œè¿æ¥è´¨é‡

### å¤šå®¢æˆ·ç«¯æ€§èƒ½é—®é¢˜
- æœåŠ¡å™¨ä¼šè‡ªåŠ¨å¤„ç†å¤šè¿æ¥
- è€ƒè™‘å¢åŠ æœåŠ¡å™¨èµ„æº
- ä¼˜åŒ–å›¾åƒç¼–ç å‚æ•°

## ğŸ“ æ–‡ä»¶è¯´æ˜

- `websocket_camera.py` - WebSocketæœåŠ¡å™¨
- `websocket_client.py` - Pythonæµ‹è¯•å®¢æˆ·ç«¯
- `websocket_client.html` - Webæµè§ˆå™¨æµ‹è¯•å®¢æˆ·ç«¯
- `requirements.txt` - Pythonä¾èµ–åŒ…

## ğŸ†š ä¸HTTPç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | HTTPç‰ˆæœ¬ | WebSocketç‰ˆæœ¬ |
|------|----------|---------------|
| å®æ—¶æ€§ | éœ€è¦è½®è¯¢ | å®æ—¶æ¨é€ |
| å»¶è¿Ÿ | è¾ƒé«˜ | è¾ƒä½ |
| å¤šå®¢æˆ·ç«¯ | æ”¯æŒ | æ”¯æŒ |
| èµ„æºæ¶ˆè€— | è¾ƒé«˜ | è¾ƒä½ |
| å®ç°å¤æ‚åº¦ | ç®€å• | ä¸­ç­‰ |
| æµè§ˆå™¨å…¼å®¹æ€§ | å¾ˆå¥½ | å¥½ |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼ 